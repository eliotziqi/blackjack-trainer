# Blackjack Trainer Pro - TODO

> 最后更新：2025-12-30

## 🔥 进行中 (In Progress)

### Practice 模式 UI/UX 改进
- [x] P0: 交互锁机制（防止重复点击）
- [x] P0-1: 按钮布局重构（两排设计）
- [x] P0-2: Dealer/Player 区域间距优化
- [x] P1-1: 按钮点击动画过渡（hover/active/focus 动效）
- [ ] P1-2: 收牌动画（模拟 Dealer 收牌）
- [x] P2-1: 连胜 Streak 显示
- [ ] **P2-1.5: Streak 动效与统计增强** 🆕
  - [x] Streak 增加时：+1 数字浮出动画（translate-y + fade-out）
  - [x] Streak 归零时：闪烁/shake 动画警告
  - [x] 达到里程碑（10/25/50/100）：特殊背景闪光或彩虹效果
  - [x] 超过历史最佳：新纪录标签 + 金色特效
  - [x] 统计数据：添加 `maxStreak`（历史最高连胜）到 PlayerStats
  - [x] 统计数据：添加 `streakMilestones` 到 PlayerStats（记录达成过的里程碑）
- [ ] P2-2: 手牌统计快速预览
- [ ] P2-3: 错误时显示 EV 对比

---

## ⚠️ 已知问题与改进计划

### 代码规范
- [ ] 🟢 低：缺少 TypeScript 严格模式检查
  - **影响**: 可能存在潜在的类型安全问题
  - **建议**: 在 `tsconfig.json` 中启用 `strict: true`

---

## 📌 待办 (Backlog)

### 高优先级 (P0)

### 中优先级 (P1)
- [ ] 添加音效（正确/错误/发牌）
- [ ] 实现暗黑/明亮主题切换
- [ ] 添加进度保存（LocalStorage）
- [ ] 优化 EV 计算性能（Web Worker）

### 低优先级 (P2)
- [ ] 卡牌计数训练模式
- [ ] 多人游戏场景模拟
- [ ] 导出练习数据为 CSV
- [ ] 添加语音提示功能
- [ ] 支持自定义训练场景

---

## 🐛 Bug 修复

- [ ] 🔴 高：Split 后的手牌计算错误
- [ ] 🟡 中：Dealer A 时 Surrender 逻辑不准确
- [ ] 🟢 低：统计页面的百分比显示精度问题

---

## 💡 想法池 (Ideas)

- 💭 添加"每日挑战"模式
- 💭 集成真实赌场规则库（Las Vegas/Macau）
- 💭 实现社交分享功能
- 💭 添加成就系统（徽章）
- 💭 支持多语言（中文/英文切换）

---

## 📝 笔记 (Notes)

### 技术债务
- 需要为 SimulationView 添加单元测试
- evCalculator 的蒙特卡洛模拟可以优化算法
- 考虑使用 Zustand 替代多个 useState

### 性能优化
- Card 组件可以使用 React.memo
- StrategyGrid 可以虚拟滚动优化大表格

---

## 🎯 里程碑 (Milestones)

### v1.0 - MVP 完成 ✅
- [x] 基础功能实现
- [x] 6 个页面模块完成
- [x] 代码重构

### v1.1 - Practice 模式优化 (当前)
- [x] UI/UX 改进（7/8 完成）
  - [x] P0: 交互锁机制
  - [x] P0-1: 两排按钮布局
  - [x] P0-2: 区域间距优化
  - [x] P1-1: 按钮动效（hover/active/focus）
  - [x] P2-1: 连胜 Streak 显示（含实时更新）
  - [x] P2-1.5: Streak 动效与统计增强（里程碑/新纪录提示）
  - [ ] P1-2: 收牌动画
  - [ ] P2-2: 手牌统计快速预览
  - [ ] P2-3: 错误时显示 EV 对比
- [x] 键盘快捷键支持（H/S/D/P/R）
- [x] 按钮禁用状态（Split/Surrender 规则检查）
- [x] Stats Reset 功能修复
- [ ] 反馈增强

### v1.2 - 性能与体验
- [ ] 移动端适配
- [ ] 音效支持
- [ ] 键盘快捷键

### v2.0 - 高级功能
- [ ] 卡牌计数模式
- [ ] 社交功能
- [ ] 成就系统

### v2.1 - 本地网络联机游戏 🆕
- [ ] WebSocket 通信框架（8-10h）
  - [ ] 使用 Express.js + ws 库
  - [ ] 实现房间管理（创建/加入/离开）
  - [ ] 客户端与服务器双向通信
- [ ] 多人游戏状态管理（12-15h）
  - [ ] 游戏状态同步机制
  - [ ] 玩家操作验证
  - [ ] 轮流决策控制
- [ ] 房间系统（6-8h）
  - [ ] 房间码生成与验证
  - [ ] 支持 2-6 人
  - [ ] 玩家加入/离开处理
  - [ ] 超时自动出局
- [ ] 安全与反作弊（8-10h）
  - [ ] 验证所有操作合法性
  - [ ] 隐藏对手信息
  - [ ] 防止重放攻击
  - [ ] 掉线重连机制
- [ ] 部署与配置（3-4h）
  - [ ] Docker 本地部署
  - [ ] 云端选项评估
  - [ ] 网络配置指南
- [ ] UI/UX 适配
  - [ ] 多人场景界面
  - [ ] 玩家列表与状态
  - [ ] 实时通知系统
  - [ ] 观战模式（可选）

**预计工时：40-50h | 优先级：P3**

---

# Observe 升级方向：**2 Hands（多手下注）功能清单**

## A. 触发与可用性（When & Whether）

* 是否支持 2 hands（全局开关）
* 是否仅限 Advantage 玩家
* 是否仅在 TC 达到阈值时允许
* TC 阈值定义（如 TC ≥ 2 / TC ≥ 4）
* 是否区分桌面状态（空桌 / 多人桌）
* 是否要求桌上存在空位
* 是否允许从 1 → 2 hands、2 → 1 hands 的动态切换
* 何时生效（立即 / 下局开始）

---

## B. 桌面与座位关系（Table & Seats）

* 2 hands 是否占用两个座位
* 多手时座位位置规则（相邻 / 固定方向）
* 原有玩家顺序是否受影响
* 空位变化（他人加入 / 离开）对 2 hands 的影响
* 桌面满员时的处理策略（禁止 / 回退为 1 hand）
* 多手状态下玩家身份标识方式（视觉区分）

---

## C. 资金与下注约束（Bankroll & Betting）

* 2 hands 是否共享同一资金池
* 每手下注金额是否相同
* 总下注金额 vs 单手下注金额的定义口径
* Min/Max bet 约束如何作用于多手
* 资金不足时的降级策略（禁用第二手 / all-in / 跳过）
* 保险、even money 是否按手独立计算
* 分牌 / 加倍时的资金检查规则（按手）

---

## D. Bet Spread 与 TC 关系（Bet Ramp Interaction）

* 2 hands 是否视为 bet spread 的一部分
* 2 hands 是否替代“更高单手下注”
* 2 hands 与 TC bins 的绑定关系
* 当 TC 回落时是否强制关闭 2 hands
* 2 hands 是否有独立的启用/禁用 TC 档位
* 是否允许 2 hands + 高倍单手同时存在
* 是否限制 ramp 单调性（避免异常跳变）

---

## E. 决策与牌局流程（Gameplay Semantics）

* 两手是否完全独立决策
* 决策顺序（主手先 / 副手先 / 按座位）
* Dealer 行为是否受多手影响
* 多手时是否共享信息展示（EV / 建议）
* 决策延迟是否按手还是按玩家计算
* 多手下暂停 / 单步执行的粒度定义

---

## F. 状态切换与异常（State Transitions & Edge Cases）

* 2 hands 状态的进入条件与退出条件
* TC 波动临界点的抖动处理（hysteresis）
* 桌面变化（有人入座）导致的冲突处理
* 玩家破产时多手的清理顺序
* 强制回退到 1 hand 时的结算一致性
* 暂停 / 离开 Observe 页面时的状态保存

---

## G. UI / 可解释性（Explainability）

* 当前是否处于 2 hands 状态的明确展示
* 2 hands 触发原因的解释（TC / 空位）
* 两手下注与总下注的区分展示
* 两手结果的合并 vs 分开展示
* 教学视角下是否高亮“多手是策略选择”

---

## H. 统计与归因（Stats & Attribution）

* 多手下注的统计口径定义
* 总手数是否按手计数
* 盈利 / 亏损是否合并或拆分
* Multiplier / Edge 的计算口径
* 2 hands 对结果的贡献归因方式
* 对比：同 TC 下 1 hand vs 2 hands 的表现

---

## I. 规则与一致性（Rules & Consistency）

* 2 hands 是否受所有桌面规则影响
* 是否与 Observe Rules 快照绑定
* 是否允许规则切换时保留 2 hands 状态
* 与未来 Phase（多手 UI、真实玩家模式）的兼容性

---

## J. 范围控制（Scope Guard）

* 是否明确标注为 Observe-only 功能
* 是否禁止在训练 / 实战模式中使用
* 是否为 Phase3 的真实多手玩家模式预留接口
* 是否提供关闭 2 hands 的简化观战模式
